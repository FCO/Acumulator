<html>
	<head>
		<script src="Acumulator.js"></script>
	</head>
	<body>
		<script>
			document.addEventListener("DOMContentLoaded", function() {
				window.acum = new Acumulator({
					onoff:	[
							"the_first_one",
							function(cmd) {
								var stat = onoff.querySelector("span#status");
								if(cmd == "toggle") {
									stat.innerHTML = stat.innerHTML == "on" ? "off" : "on";
								}
							}
						],
					sum:	[
							"somatory",
							function(value) {
								var stat = sum.querySelector("span#status");
								stat.innerHTML = parseInt(stat.innerHTML) + value;
							}
						],
					form:	{
							agregator_func: "the_last_one",
							callback:	function(parentForm) {
										var elem = parentForm.elements;
										for(var i = 0; i < elem.length; i++) {
											if(! elem[i].name) continue;
											var vkey = document.querySelector("td#" + elem[i].name);
											vkey.innerHTML = elem[i].value;
										}
									}
						},
					save:	{
							agregator_func: "the_last_one",
							callback:	function(data) {
										var save = document.querySelector("span#save");
										save.innerHTML = "saving...";
										setTimeout(function(){
											save.innerHTML = "";
										}, 3000);
									},
							condition2exec:	function() {
								return navigator.onLine;
							}
						},
				});
				window.acum.condition2exec = function(){return navigator.onLine};
				window.addEventListener('online', function(){window.acum.try2run()});
				window.acum.waiting_time = 500;
				window.acum.sub("save").waiting_time = 2000;
			}, false);
		</script>
		<button id="onoff" onclick="window.acum.sub(this.id).push('toggle')">
		<span id="status">off</span>
		</button>
		<button id="sum" onclick="window.acum.sub(this.id).push(1)">
		<span id="status">0</span>
		</button>
		<table>
			<tr><td>key1</td><td id="vkey1">value1</td></tr>
			<tr><td>key2</td><td id="vkey2">value2</td></tr>
			<tr><td>key3</td><td id="vkey3">value3</td></tr>
		</table>
		<form>
			key1: <input name=vkey1 value="value1" onkeyup="window.acum.sub('form').push(this.parentNode)"><br />
			key2: <input name=vkey2 value="value2" onkeyup="window.acum.sub('form').push(this.parentNode)"><br />
			key3: <input name=vkey3 value="value3" onkeyup="window.acum.sub('form').push(this.parentNode)"><br />
		</form><br />
		<span id=save style="background-color: yellow"></span><br />
		<textarea cols=50 rows=10 onkeyup="window.acum.sub('save').push(this.value)"></textarea>
	</body>
</html>
