<html>
	<head>
		<script src="Acumulator.js"></script>
	</head>
	<body>
		<script>
			document.addEventListener("DOMContentLoaded", function() {
				window.acum = new Acumulator({
					onoff:	{
							_agregator_func:	"the_first_one",
							_callback:		function(cmd) {
											var stat = onoff.querySelector("span#status");
											if(cmd == "toggle") {
												stat.innerHTML = stat.innerHTML == "on" ? "off" : "on";
											}
										},
							_push_data_on_event:	{
											obj:	document.querySelector("button#onoff"),
											event:	"click",
											data:	"toggle"
										},
							_delayable: false
						},
					sum:	{
							_agregator_func:	"somatory",
							_callback:		function(value) {
											var stat = sum.querySelector("span#status");
											stat.innerHTML = parseInt(stat.innerHTML) + value;
										},
							_push_data_on_event:	{
											obj:	document.querySelector("button#sum"),
											event:	"click",
											data:	1
										},
							_delayable: false
						},
					form:	{
							_agregator_func: "the_last_one",
							_callback:	function(parentForm) {
										var elem = parentForm.elements;
										for(var i = 0; i < elem.length; i++) {
											if(! elem[i].name) continue;
											var vkey = document.querySelector("td#" + elem[i].name);
											vkey.innerHTML = elem[i].value;
										}
									},
							_push_data_on_event:	{
											obj:	document.forms[0].querySelectorAll("input"),
											event:	"keyup",
											data:	document.forms[0]
										}
						},
					save:	{
							_agregator_func: "the_last_one",
							_callback:	function(data) {
										var save = document.querySelector("span#save");
										save.innerHTML = "saving...";
										setTimeout(function(){
											save.innerHTML = "";
										}, 3000);
									},
							_waiting_time:	2000,
							_push_data_on_event:	{
											obj:	document.querySelector("textarea"),
											event:	"keyup",
											data:	function() {
												return this.value;
											}
										}
						},
					_condition2exec: "online",
					_waiting_time: 500,
					_retry_on_event: {
						obj:	window,
						event:	"online"
					}
				});
			}, false);
		</script>
		<button id="onoff">
		<span id="status">off</span>
		</button>
		<button id="sum">
		<span id="status">0</span>
		</button>
		<table>
			<tr><td>key1</td><td id="vkey1">value1</td></tr>
			<tr><td>key2</td><td id="vkey2">value2</td></tr>
			<tr><td>key3</td><td id="vkey3">value3</td></tr>
		</table>
		<form>
			key1: <input name=vkey1 value="value1"><br />
			key2: <input name=vkey2 value="value2"><br />
			key3: <input name=vkey3 value="value3"><br />
		</form><br />
		<span id=save style="background-color: yellow"></span><br />
		<textarea cols=50 rows=10></textarea>
	</body>
</html>
